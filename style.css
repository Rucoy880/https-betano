let saldo = 10.00;
const saldoElement = document.getElementById('saldo');
const mensagem = document.getElementById('mensagem');
const spinBtn = document.getElementById('spinBtn');
const winSound = document.getElementById('winSound');
const canvas = document.getElementById('confetti');
const ctx = canvas.getContext('2d');

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let particles = [];

// Confete
function createParticles() {
  for (let i = 0; i < 150; i++) {
    particles.push({
      x: Math.random() * canvas.width,
      y: Math.random() * canvas.height - canvas.height,
      size: Math.random() * 10 + 5,
      speed: Math.random() * 6 + 3,
      color: ['#ff0000', '#00ff00', '#ffff00', '#ff00ff', '#00ffff', '#ffd700'][Math.floor(Math.random() * 6)],
      rotation: Math.random() * 360,
      rotSpeed: Math.random() * 12 - 6
    });
  }
}

function animateConfetti() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  particles = particles.filter(p => p.y < canvas.height);
  particles.forEach(p => {
    p.y += p.speed;
    p.rotation += p.rotSpeed;
    ctx.save();
    ctx.translate(p.x, p.y);
    ctx.rotate(p.rotation * Math.PI / 180);
    ctx.fillStyle = p.color;
    ctx.fillRect(-p.size/2, -p.size/2, p.size, p.size);
    ctx.restore();
  });
  requestAnimationFrame(animateConfetti);
}

// Loading fake
setTimeout(() => {
  document.getElementById('loading').classList.add('hidden');
  document.getElementById('game').classList.remove('hidden');
}, 4000);

// Girar
spinBtn.addEventListener('click', () => {
  if (saldo < 0.40) {
    mensagem.textContent = "Saldo insuficiente! Recarregue.";
    mensagem.style.color = "#ff0000";
    return;
  }

  saldo -= 0.40;
  saldoElement.textContent = `R$ ${saldo.toFixed(2).replace('.', ',')}`;

  spinBtn.disabled = true;
  spinBtn.textContent = "GIRANDO...";
  mensagem.textContent = "Girando... Boa sorte! ðŸ€";

  const reels = document.querySelectorAll('.reel');
  reels.forEach(reel => reel.style.animationPlayState = 'running');

  setTimeout(() => {
    reels.forEach(reel => reel.style.animationPlayState = 'paused');

    const ganhou = Math.random() > 0.4; // 60% chance de ganhar pra nÃ£o zerar rÃ¡pido
    if (ganhou) {
      const ganho = Math.floor(Math.random() * 500) + 50;
      saldo += ganho;
      saldoElement.textContent = `R$ ${saldo.toFixed(2).replace('.', ',')}`;
      mensagem.textContent = `GANHOU R$ ${ganho}! ðŸ”¥`;
      mensagem.style.color = "#00ff41";
      winSound.play();
      createParticles();
    } else {
      mensagem.textContent = "Tente novamente... quase!";
      mensagem.style.color = "#ff0000";
    }

    spinBtn.disabled = false;
    spinBtn.textContent = "GIRAR";
  }, 3000);
});

animateConfetti();
